<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>British Hills Camp - Get to Know You!</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .game-tile {
            transition: all 0.2s ease-in-out;
        }
        .game-tile.selected {
            transform: scale(1.05);
            box-shadow: 0 0 0 3px theme('colors.blue.500');
            background-color: theme('colors.blue.100');
        }
        .game-tile.correct {
            background-color: theme('colors.green.500');
            color: white;
            transform: scale(1.05);
        }
        .game-tile.incorrect {
            background-color: theme('colors.red.500');
            color: white;
            transform: scale(1.05);
        }
    </style>
</head>
<body class="bg-gray-100">

    <!-- Header -->
    <header class="bg-white shadow-md">
        <div class="container mx-auto max-w-5xl px-4 py-6">
            <h1 class="text-3xl font-bold text-gray-800">Welcome to the Camp!</h1>
            <p class="mt-2 text-lg text-gray-600">We're excited to have you at British Hills.</p>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto max-w-5xl px-4 py-8">

        <!-- 1. Welcome Message -->
        <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg mb-8">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4">A Quick Welcome Note</h2>
            <div class="space-y-4 text-gray-600">
                <p>Hello and welcome! We are so glad you'll be joining us for our upcoming camp. This is a special program for intermediate and advanced learners, and we can't wait to get started.</p>
                <p>Before you arrive, we'd love to get to know you a little better. Below is an optional form where you can tell us a bit about yourself. This will help our teachers plan some activities and create a great experience for everyone.</p>
                <p>We've also added a small game at the bottom of the page to help you warm up your English skills. Have fun, and we look forward to seeing you soon!</p>
            </div>
        </div>

        <!-- 2. "My Camp Profile" Form -->
        <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg mb-8">
            <h2 class="text-2xl font-semibold text-gray-700 mb-6">My Camp Profile (Optional)</h2>
            
            <form id="profile-form" class="space-y-6">
                <!-- Full Name -->
                <div>
                    <label for="full-name" class="block text-sm font-medium text-gray-700">Full Name</label>
                    <input type="text" name="full-name" id="full-name" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-3" placeholder="Sakura Tanaka">
                </div>

                <!-- Nickname -->
                <div>
                    <label for="nickname" class="block text-sm font-medium text-gray-700">What would you like to be called?</label>
                    <input type="text" name="nickname" id="nickname" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-3" placeholder="Saki">
                </div>

                <!-- Interests -->
                <div>
                    <span class="block text-sm font-medium text-gray-700">What are your interests?</span>
                    <div class="mt-2 space-y-2">
                        <!-- Sports -->
                        <div class="flex items-start">
                            <div class="flex h-5 items-center">
                                <input id="interest-sports" name="interest-sports" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                            </div>
                            <div class="ml-3 text-sm">
                                <label for="interest-sports" class="font-medium text-gray-700">Sports</label>
                            </div>
                        </div>
                        <input type="text" name="sports-details" id="sports-details" class="hidden mt-1 mb-2 w-full rounded-md border-gray-300 shadow-sm sm:text-sm p-3" placeholder="What sports do you like?">

                        <!-- Music -->
                        <div class="flex items-start">
                            <div class="flex h-5 items-center">
                                <input id="interest-music" name="interest-music" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                            </div>
                            <div class="ml-3 text-sm">
                                <label for="interest-music" class="font-medium text-gray-700">Music</label>
                            </div>
                        </div>
                        <input type="text" name="music-details" id="music-details" class="hidden mt-1 mb-2 w-full rounded-md border-gray-300 shadow-sm sm:text-sm p-3" placeholder="What music do you like?">

                        <!-- Video Games -->
                        <div class="flex items-start">
                            <div class="flex h-5 items-center">
                                <input id="interest-games" name="interest-games" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                            </div>
                            <div class="ml-3 text-sm">
                                <label for="interest-games" class="font-medium text-gray-700">Video Games</label>
                            </div>
                        </div>
                        <input type="text" name="games-details" id="games-details" class="hidden mt-1 mb-2 w-full rounded-md border-gray-300 shadow-sm sm:text-sm p-3" placeholder="What video games do you like?">

                        <!-- Reading -->
                        <div class="flex items-start">
                            <div class="flex h-5 items-center">
                                <input id="interest-reading" name="interest-reading" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                            </div>
                            <div class="ml-3 text-sm">
                                <label for="interest-reading" class="font-medium text-gray-700">Reading</label>
                            </div>
                        </div>
                        <input type="text" name="reading-details" id="reading-details" class="hidden mt-1 mb-2 w-full rounded-md border-gray-300 shadow-sm sm:text-sm p-3" placeholder="What kind of books do you like?">

                        <!-- Art -->
                        <div class="flex items-start">
                            <div class="flex h-5 items-center">
                                <input id="interest-art" name="interest-art" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                            </div>
                            <div class="ml-3 text-sm">
                                <label for="interest-art" class="font-medium text-gray-700">Art</label>
                            </div>
                        </div>
                        <input type="text" name="art-details" id="art-details" class="hidden mt-1 mb-2 w-full rounded-md border-gray-300 shadow-sm sm:text-sm p-3" placeholder="What kind of art do you like?">

                        <!-- Other -->
                        <div class="flex items-start">
                            <div class="flex h-5 items-center">
                                <input id="interest-other-check" name="interest-other-check" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                            </div>
                            <div class="ml-3 text-sm">
                                <label for="interest-other-check" class="font-medium text-gray-700">Other</label>
                            </div>
                        </div>
                        <input type="text" name="interest-other-text" id="interest-other-text" class="hidden mt-1 mb-2 w-full rounded-md border-gray-300 shadow-sm sm:text-sm p-3" placeholder="Please specify...">
                    </div>
                </div>

                <!-- My Goal -->
                <div>
                    <label for="goal" class="block text-sm font-medium text-gray-700">My Goal at British Hills</label>
                    <textarea id="goal" name="goal" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-3" placeholder="One thing I want to improve is..."></textarea>
                </div>

                <!-- Icebreaker -->
                <div>
                    <label for="icebreaker" class="block text-sm font-medium text-gray-700">Icebreaker: If you could have one superpower, what would it be and why?</label>
                    <textarea id="icebreaker" name="icebreaker" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-3" placeholder="If I could have one superpower, it would be..."></textarea>
                </div>

                <!-- Submit Button -->
                <div>
                    <button type="submit" id="submit-btn" class="inline-flex justify-center rounded-md border border-transparent bg-blue-600 py-3 px-6 text-base font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 w-full sm:w-auto">
                        Submit My Profile
                    </button>
                    <p id="error-message" class="hidden mt-3 text-sm text-red-600"></p>
                </div>
            </form>
        </div>

        <!-- 3. British vs American English Game -->
        <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg">
            <h2 class="text-2xl font-semibold text-gray-700 mb-2">Game: British vs. American English</h2>
            <p class="text-gray-600 mb-6">Match the British English word (left) to its American English equivalent (right). Good luck!</p>
            
            <div class="flex flex-col md:flex-row md:space-x-8">
                <!-- Column 1: British English -->
                <div id="game-col-1" class="flex-1 space-y-3 mb-4 md:mb-0">
                    <!-- Tiles will be injected by JS -->
                </div>
                <!-- Column 2: American English -->
                <div id="game-col-2" class="flex-1 space-y-3">
                    <!-- Tiles will be injected by JS -->
                </div>
            </div>
            
            <button id="game-reset-btn" class="mt-6 inline-flex justify-center rounded-md border border-transparent bg-gray-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2">
                Reset Game
            </button>
        </div>
    </main>

    <!-- Success Modal -->
    <div id="success-modal" class="hidden fixed inset-0 z-10 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
            <!-- Background overlay -->
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
            </div>
            <!-- Modal content -->
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-sm sm:w-full sm:p-6">
                <div>
                    <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100">
                        <!-- Heroicon: check -->
                        <svg class="h-6 w-6 text-green-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                    </div>
                    <div class="mt-3 text-center sm:mt-5">
                        <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">Thank You!</h3>
                        <div class="mt-2">
                            <p class="text-sm text-gray-500">Your profile has been submitted. We look forward to seeing you at the camp!</p>
                        </div>
                    </div>
                </div>
                <div class="mt-5 sm:mt-6">
                    <button id="close-modal-btn" type="button" class="inline-flex justify-center w-full rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:text-sm">
                        Got it!
                    </button>
                </div>
            </div>
        </div>
    </div>


    <!-- Firebase and App Logic -->
    <script type="module">
        // Import Firebase SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- PASTE YOUR FIREBASE CONFIG OBJECT HERE ---
        const firebaseConfig = {
          apiKey: "AIzaSyCXr9MHZ6vRJ6_u5zWL7x-OatnxEGj2VYU",
          authDomain: "long-english-camp.firebaseapp.com",
          projectId: "long-english-camp",
          storageBucket: "long-english-camp.firebasestorage.app",
          messagingSenderId: "881175905434",
          appId: "1:881175905434:web:ac95bb0b19274f8c820b23"
        };
        // ---------------------------------------------

        // --- Initialize Firebase and App State ---
        let db; // <-- Moved db variable
        let isConnected = false;
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        
        // ** DEBUGGING: Moved db initialization here and added logs **
        try {
            db = getFirestore(app);
            console.log("Firestore initialized (db variable set):", db);
            setLogLevel('debug'); // Enable detailed Firestore logging
        } catch (error) {
            console.error("Firestore initialization error:", error);
        }

        const profileForm = document.getElementById('profile-form');
        const submitBtn = document.getElementById('submit-btn');
        const errorMessage = document.getElementById('error-message');
        const successModal = document.getElementById('success-modal');
        const closeModalBtn = document.getElementById('close-modal-btn');

        // --- Firebase Connection ---
        signInAnonymously(auth)
          .then(() => {
            console.log("Firebase anonymous sign-in successful.");
            isConnected = true;
          })
          .catch((error) => {
            console.error("Firebase sign-in error:", error);
            errorMessage.textContent = "Error: Could not connect to auth. Please refresh.";
            errorMessage.classList.remove('hidden');
          });

        // --- Form Logic: Conditional Inputs ---
        const otherCheck = document.getElementById('interest-other-check');
        const otherText = document.getElementById('interest-other-text');
        otherCheck.addEventListener('change', () => {
            otherText.classList.toggle('hidden', !otherCheck.checked);
        });

        // Helper for conditional interest fields
        function setupConditionalInput(checkId, inputId) {
            const check = document.getElementById(checkId);
            const input = document.getElementById(inputId);
            check.addEventListener('change', () => {
                input.classList.toggle('hidden', !check.checked);
            });
        }
        setupConditionalInput('interest-sports', 'sports-details');
        setupConditionalInput('interest-music', 'music-details');
        setupConditionalInput('interest-games', 'games-details');
        setupConditionalInput('interest-reading', 'reading-details');
        setupConditionalInput('interest-art', 'art-details');

        // --- Form Logic: Submission ---
        profileForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            // ** DEBUGGING: Added more detailed check **
            if (!db || !isConnected) {
                console.warn("Form submit failed. !db or !isConnected", { db, isConnected });
                errorMessage.textContent = 'Error: Not connected. Please refresh the page.';
                errorMessage.classList.remove('hidden');
                return;
            }

            // Show loading state
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';
            errorMessage.classList.add('hidden');

            try {
                // 1. Get all form data
                const formData = new FormData(profileForm);
                const profileData = {
                    fullName: formData.get('full-name'),
                    nickname: formData.get('nickname'),
                    interests: {
                        sports: formData.get('interest-sports') === 'on',
                        sportsDetails: formData.get('sports-details'),
                        music: formData.get('interest-music') === 'on',
                        musicDetails: formData.get('music-details'),
                        games: formData.get('interest-games') === 'on',
                        gamesDetails: formData.get('games-details'),
                        reading: formData.get('interest-reading') === 'on',
                        readingDetails: formData.get('reading-details'),
                        art: formData.get('interest-art') === 'on',
                        artDetails: formData.get('art-details'),
                        other: formData.get('interest-other-check') === 'on',
                        otherDetails: formData.get('interest-other-text'),
                    },
                    goal: formData.get('goal'),
                    icebreaker: formData.get('icebreaker'),
                    submittedAt: new Date().toISOString()
                };

                // 2. Send data to Firestore
                // We will use the simple path we defined in our rules
                console.log("Attempting to add document to 'studentProfiles'...");
                const docRef = await addDoc(collection(db, "studentProfiles"), profileData);
                console.log("Document written with ID: ", docRef.id);

                // 3. Show success
                successModal.classList.remove('hidden');
                profileForm.reset();
                // Manually hide conditional fields
                ['sports-details', 'music-details', 'games-details', 'reading-details', 'art-details', 'interest-other-text'].forEach(id => {
                    document.getElementById(id).classList.add('hidden');
                });


            } catch (error) {
                // 4. Show error
                console.error("Error adding document: ", error);
                errorMessage.textContent = `Error: ${error.message}. Please try again.`;
                errorMessage.classList.remove('hidden');
            } finally {
                // 5. Reset button
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit My Profile';
            }
        });

        // Close success modal
        closeModalBtn.addEventListener('click', () => {
            successModal.classList.add('hidden');
        });


        // --- Game Logic ---
        const gameData = {
            'Trousers': 'Pants',
            'Lift': 'Elevator',
            'Biscuit': 'Cookie',
            'Flat': 'Apartment',
            'Queue': 'Line',
            'Rubbish': 'Garbage / Trash',
            'Chips': 'French Fries',
            'Post': 'Mail'
        };

        const col1 = document.getElementById('game-col-1');
        const col2 = document.getElementById('game-col-2');
        const resetBtn = document.getElementById('game-reset-btn');
        let selectedTile = null;
        let correctMatches = 0;

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function createTile(text, column, pair) {
            const tile = document.createElement('div');
            tile.textContent = text;
            tile.dataset.pair = pair;
            tile.dataset.column = column;
            tile.className = 'game-tile p-4 bg-white border rounded-lg shadow-sm cursor-pointer hover:bg-gray-50';
            
            tile.addEventListener('click', onTileClick);
            return tile;
        }

        function initGame() {
            col1.innerHTML = '';
            col2.innerHTML = '';
            selectedTile = null;
            correctMatches = 0;

            const britishWords = Object.keys(gameData);
            const americanWords = Object.values(gameData);
            const shuffledAmerican = shuffle([...americanWords]);

            britishWords.forEach(word => {
                col1.appendChild(createTile(word, 1, word));
            });
            shuffledAmerican.forEach(word => {
                const britishWord = Object.keys(gameData).find(key => gameData[key] === word);
                col2.appendChild(createTile(word, 2, britishWord));
            });
        }

        function onTileClick(e) {
            const clickedTile = e.target;

            // If this tile is already correct, do nothing
            if (clickedTile.classList.contains('correct')) {
                return;
            }

            // If no tile is selected
            if (!selectedTile) {
                // Can't select from the same column twice
                document.querySelectorAll(`[data-column="${clickedTile.dataset.column}"]`).forEach(t => t.classList.remove('selected'));
                clickedTile.classList.add('selected');
                selectedTile = clickedTile;
                return;
            }

            // If a tile is already selected, check for a match
            // Don't allow clicking the same tile or a tile in the same column
            if (selectedTile === clickedTile || selectedTile.dataset.column === clickedTile.dataset.column) {
                selectedTile.classList.remove('selected');
                clickedTile.classList.add('selected');
                selectedTile = clickedTile;
                return;
            }

            // Check for match
            if (selectedTile.dataset.pair === clickedTile.dataset.pair) {
                // Correct!
                selectedTile.classList.remove('selected');
                selectedTile.classList.add('correct');
                clickedTile.classList.add('correct');
                selectedTile.style.pointerEvents = 'none';
                clickedTile.style.pointerEvents = 'none';
                selectedTile = null;
                correctMatches++;
                
                if (correctMatches === Object.keys(gameData).length) {
                    // Game over! You could add a message here.
                }
            } else {
                // Incorrect
                selectedTile.classList.add('incorrect');
                clickedTile.classList.add('incorrect');
                
                const st = selectedTile; // Store for timeout
                setTimeout(() => {
                    st.classList.remove('selected', 'incorrect');
                    clickedTile.classList.remove('selected', 'incorrect');
                }, 800);
                selectedTile = null;
            }
        }

        resetBtn.addEventListener('click', initGame);

        // Start the game on page load
        initGame();

    </script>
</body>
</html>


